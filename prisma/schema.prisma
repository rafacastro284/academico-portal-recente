generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////
//    RELACIONAMENTOS N:N   //
//////////////////////////////

model turmadisciplina {
  id             Int          @id @default(autoincrement())
  turmaid        Int
  disciplinaid   Int

  turma          turma        @relation(fields: [turmaid], references: [idturma])
  disciplina     disciplina   @relation(fields: [disciplinaid], references: [iddisciplina])

  @@unique([turmaid, disciplinaid])
}

//////////////////////////////
//      TABELAS PRINCIPAIS  //
//////////////////////////////

model usuario {
  idusuario            Int                @id @default(autoincrement())
  cpf                  String?            @unique
  matricula            String?
  nome                 String?
  email                String?            @unique
  senha                String?
  tipo                 tipo_usuario

  alunodisciplina      alunodisciplina[]

  // PROFESSOR
  disciplinasMinistradas disciplina[] @relation("ProfMinistra")

  matriculaturma       matriculaturma[]
}

model disciplina {
  iddisciplina      Int                @id @default(autoincrement())
  idprofessor       Int
  nome_disciplina   String?
  carga_horaria     Int?

  professor         usuario            @relation("ProfMinistra", fields: [idprofessor], references: [idusuario])
  alunodisciplina   alunodisciplina[]
  tarefa            tarefa[]
  turmas            turmadisciplina[]
}

model turma {
  idturma        Int               @id @default(autoincrement())
  nome_turma     String?
  ano_letivo     Int?
  limite_vagas   Int?
  serie          String?
  turno          String?

  matriculaturma matriculaturma[]
  disciplinas    turmadisciplina[]
}

//////////////////////////////
//     RELAÇÕES AUXILIARES  //
//////////////////////////////

model alunodisciplina {
  idalunodisciplina Int          @id @default(autoincrement())
  idaluno           Int
  iddisciplina      Int

  aluno             usuario      @relation(fields: [idaluno], references: [idusuario])
  disciplina        disciplina   @relation(fields: [iddisciplina], references: [iddisciplina])
  frequencia        frequencia[]
  nota              nota[]
}

model frequencia {
  idfrequencia      Int           @id @default(autoincrement())
  idalunodisciplina Int
  data              DateTime?     @db.Date
  faltas            Int?          @default(0)

  alunodisciplina   alunodisciplina @relation(fields: [idalunodisciplina], references: [idalunodisciplina])
}

model nota {
  idnota            Int           @id @default(autoincrement())
  idalunodisciplina Int
  descricao         String?
  valor             Decimal?      @db.Decimal(5, 2)
  data              DateTime?     @db.Date

  alunodisciplina   alunodisciplina @relation(fields: [idalunodisciplina], references: [idalunodisciplina])
}

model tarefa {
  idtarefa     Int          @id @default(autoincrement())
  iddisciplina Int
  tipo         String?
  descricao    String?

  disciplina   disciplina @relation(fields: [iddisciplina], references: [iddisciplina])
}

model matriculaturma {
  idmatriculaturma Int @id @default(autoincrement())
  idusuario        Int
  idturma          Int

  turma   turma   @relation(fields: [idturma], references: [idturma])
  usuario usuario @relation(fields: [idusuario], references: [idusuario])
}

//////////////////////////////
//          ENUMS           //
//////////////////////////////

enum tipo_usuario {
  aluno
  professor
  secretario
  admin
  diretor
}
