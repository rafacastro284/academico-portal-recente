generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////
//   RELACIONAMENTOS N:N    //
//////////////////////////////
model TurmaDisciplina {
  id            Int @id @default(autoincrement())
  turmaId       Int
  disciplinaId  Int

  turma        turma       @relation(fields: [turmaId], references: [idturma])
  disciplina   disciplina  @relation(fields: [disciplinaId], references: [iddisciplina])

  @@unique([turmaId, disciplinaId])   // evita dupla inserÃ§Ã£o
}

//////////////////////////////
//     TABELAS PRINCIPAIS   //
//////////////////////////////

model usuario {
  idusuario       Int                @id @default(autoincrement())
  cpf             String?            @unique @db.VarChar(14)
  matricula       String?            @db.VarChar(20)
  nome            String?            @db.VarChar(100)
  email           String?            @unique @db.VarChar(100)
  senha           String?            @db.VarChar(255)
  tipo            tipo_usuario

  // relaÃ§Ãµes
  alunodisciplina alunodisciplina[]
  disciplina      disciplina[]       // professor ministra vÃ¡rias disciplinas
  matriculaturma  matriculaturma[]
}


model disciplina {
  iddisciplina    Int                @id @default(autoincrement())
  idprofessor     Int
  nome_disciplina String?            @db.VarChar(100)
  carga_horaria   Int?

  // relaÃ§Ãµes
  professor       usuario            @relation(fields: [idprofessor], references: [idusuario])
  alunodisciplina alunodisciplina[]
  tarefa          tarefa[]
  turmas          TurmaDisciplina[]  // ðŸ”¥ vincula disciplinas Ã s turmas
}


model turma {
  idturma         Int                @id @default(autoincrement())
  nome_turma      String?            @db.VarChar(50)
  ano_letivo      Int?
  limite_vagas    Int?
  serie           String?            @db.VarChar(50)
  turno           String?            @db.VarChar(30)

  // relaÃ§Ãµes
  matriculaturma  matriculaturma[]
  disciplinas     TurmaDisciplina[]  // ðŸ”¥ vincula turmas Ã s disciplinas
}


//////////////////////////////
//     RELAÃ‡Ã•ES AUXILIARES  //
//////////////////////////////

model alunodisciplina {
  idalunodisciplina Int              @id @default(autoincrement())
  idaluno           Int
  iddisciplina      Int

  usuario           usuario          @relation(fields: [idaluno], references: [idusuario])
  disciplina        disciplina       @relation(fields: [iddisciplina], references: [iddisciplina])
  frequencia        frequencia[]
  nota              nota[]
}


model frequencia {
  idfrequencia      Int              @id @default(autoincrement())
  idalunodisciplina Int
  data              DateTime?        @db.Date
  faltas            Int?             @default(0)

  alunodisciplina   alunodisciplina  @relation(fields: [idalunodisciplina], references: [idalunodisciplina])
}


model nota {
  idnota            Int              @id @default(autoincrement())
  idalunodisciplina Int
  descricao         String?          @db.VarChar(200)
  valor             Decimal?         @db.Decimal(5, 2)
  data              DateTime?        @db.Date

  alunodisciplina   alunodisciplina  @relation(fields: [idalunodisciplina], references: [idalunodisciplina])
}


model tarefa {
  idtarefa        Int               @id @default(autoincrement())
  iddisciplina    Int
  tipo            String?           @db.VarChar(50)
  descricao       String?

  disciplina      disciplina        @relation(fields: [iddisciplina], references: [iddisciplina])
}


model matriculaturma {
  idmatriculaturma Int              @id @default(autoincrement())
  idusuario        Int
  idturma          Int

  turma            turma            @relation(fields: [idturma], references: [idturma])
  usuario          usuario          @relation(fields: [idusuario], references: [idusuario])
}

//////////////////////////////
//        ENUMS            //
//////////////////////////////

enum tipo_usuario {
  aluno
  professor
  secretario
  admin
  diretor
}
